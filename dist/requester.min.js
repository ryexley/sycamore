// sycamore, v0.2.3 | (c) 2013 Bob Yexley
// Description: A mixin with functionality to wrap jQuery $.ajax calls, and simplify the definition and consumption of $.ajax request options 
// Generated: 2013-10-11 @ 10:42:48
// https://github.com/ryexley/sycamore
// License: http://www.opensource.org/licenses/mit-license
!function(a,b){"function"==typeof define&&define.amd?define(["jquery","underscore"],b):"object"==typeof exports?module.exports=b(require("jquery"),require("underscore")):a.Requester=b(a.$,a._)}(this,function(a,b){b.templateSettings={interpolate:/\{(.+?)\}/g};var c={_requestsInitialized:!1,_requests:{},_memoryCache:{},_setupRequests:function(){var a=this;a._requestsInitialized||(a._requests={},a._memoryCache={},a.requests&&b.each(a.requests,function(c,d){var e={};b.each(c,function(b,c){"requestRefMap"!==c&&(e[c]=a._executeOptions[c](b,a))}),a._requests[d]=e,a.requests[d].requestRefMap={type:"_requests",name:d}}),a._requestsInitialized=!0)},_executeOptions:{url:function(a){return a},type:function(a){return a},contentType:function(a){return a},context:function(a){return a},data:function(a,b){return b[a]?b[a]:a},dataType:function(a){return a},done:function(a,b){return b[a]},fail:function(a,b){return b[a]},delayFor:function(a){return a},cache:function(a){return a}},_isLocalStorageSupported:function(){var a="supported";try{return localStorage.setItem(a,a),localStorage.removeItem(a),!0}catch(b){return!1}},_cacheData:function(a,b){if("local"===a.store&&this._isLocalStorageSupported()){var c=JSON.parse(localStorage.getItem("requestDataCache"))||{};c[a.key]=b,localStorage.setItem("requestDataCache",JSON.stringify(c))}else this._memoryCache[a.key]=b;a.expires=this.dates.addMinutes(Date.now(),a.expiresAfter)},_getCachedData:function(a){if("local"===a.store&&this._isLocalStorageSupported()){var b=JSON.parse(localStorage.getItem("requestDataCache"));return b[a.key]}return this._memoryCache[a.key]},execute:function(c,d){var e,f=this;if(c.cache){var g=!0;if(c.cache.expires&&this.dates.compare(Date.now(),c.cache.expires)<0&&(g=!1),!g){var h=f._getCachedData(c.cache);if(h){var i=a.Deferred();return i.resolve(h),i.promise()}}}if(f._requestsInitialized||f._setupRequests(),c=f[c.requestRefMap.type][c.requestRefMap.name],e=b.isFunction(c.data)?c.data.call(c.context||f):c.data,e=arguments.length>1?d:e,c.url.indexOf("{")&&c.url.indexOf("}")&&!b.isEmpty(e)){var j=b.template(c.url,e);if(!c.type||"get"===c.type.toLowerCase()){var k=c.url.match(/{(.*?)}/g);b.each(k,function(a){a=a.replace("{","").replace("}",""),delete e[a]})}c.url=j}return c.delayFor?f._executeDelayed(c,e):f._execute(c,e)},_execute:function(b,c){var d=this,e=a.ajax({url:b.url,type:b.type||"get",data:c||{},dataType:b.dataType||"json",contentType:b.contentType||"application/json; charset=utf-8",context:b.context||d});return e.done(function(a){b.cache&&d._cacheData(b.cache,a)}),d._handleConfiguredCallbacks(b,e),e},_executeDelayed:function(b,c){var d,e=this,f=a.Deferred();return setTimeout(function(){d=a.ajax({url:b.url,type:b.type||"get",data:c||{},dataType:b.dataType||"json",contentType:b.contentType||"application/json; charset=utf-8",context:b.context||e}).done(function(){f.resolve.apply(d,arguments)}).fail(function(){f.reject.apply(d,arguments)}),d.done(function(a){b.cache&&e._cacheData(b.cache,a)}),e._handleConfiguredCallbacks(b,d)},b.delayFor),f.promise()},_handleConfiguredCallbacks:function(a,b){var c=this;a.done&&b.done(a.done.bind(a.context||c)),a.fail&&b.fail(a.fail.bind(a.context||c)),a.always&&b.always(a.always.bind(a.context||c))},fetch:function(a){return this.execute(a)},dates:{convert:function(a){var b=a.constructor===Date?a:a.constructor===Array?new Date(a[0],a[1],a[2]):a.constructor===Number?new Date(a):a.constructor===String?new Date(a):"object"==typeof a?new Date(a.year,a.month,a.date):0/0;return b},compare:function(a,b){var c=isFinite(a=this.convert(a).valueOf())&&isFinite(b=this.convert(b).valueOf())?(a>b)-(b>a):!1;return c},inRange:function(a,b,c){var d=isFinite(a=this.convert(a).valueOf())&&isFinite(b=this.convert(b).valueOf())&&isFinite(c=this.convert(c).valueOf())?a>=b&&c>=a:0/0;return d},addMinutes:function(a,b){if(isFinite(a=this.convert(a).valueOf())){var c=this.convert(a);return this.convert(c.setMinutes(c.getMinutes()+b))}return!1}}};return c});